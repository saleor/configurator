---
name: discover
description: Generate Saleor configuration by exploring your existing website with chrome-devtools - analyze business context and translate website state to config
allowed-tools: Bash, Read, Write, Edit, AskUserQuestion, Glob, Grep, Task
argument-hint: [url] [--introspect]
---

# Discover

Intelligently generate Saleor configuration by exploring your existing website. This command uses chrome-devtools MCP to analyze your site's structure, business context, and product catalog, then translates it into a proper config.yml.

## Usage

```bash
# Interactive discovery (recommended)
/discover

# Quick discovery from URL
/discover https://example.com

# With Saleor introspection (if already have Saleor instance)
/discover --introspect --url=$SALEOR_API_URL --token=$SALEOR_TOKEN
```

## Two Discovery Modes

### Mode 1: Website Exploration (chrome-devtools)

Analyze an existing website to understand business model and generate config.

**Best for**:
- Migrating from another platform
- Rebuilding existing store in Saleor
- Learning from competitor sites
- Understanding business requirements

### Mode 2: Saleor Introspection

Pull configuration from existing Saleor instance.

**Best for**:
- Starting config.yml from live store
- Syncing with production
- Documenting existing setup
- Creating staging config

## Workflow

### Step 1: Discovery Method Selection

If no argument provided, ask via AskUserQuestion:

**Question**: "How would you like to discover your store configuration?"
**Options**:
1. Explore existing website (requires URL)
2. Introspect Saleor instance (requires credentials)
3. Manual input (guided questions)

### Step 2A: Website Exploration Workflow

**Prerequisites Check**:

```bash
# Check if chrome-devtools MCP is available
mcp-cli tools | grep chrome-devtools
```

If not available:
- Explain chrome-devtools MCP is needed
- Show installation instructions
- Offer to continue with manual input instead

**Exploration Process**:

1. **Get website URL**:
   - Ask user for site URL
   - Validate URL format
   - Check if accessible

2. **Launch browser session**:
```bash
# Via mcp-cli (check schema first)
mcp-cli info chrome-devtools/new_page
mcp-cli call chrome-devtools/new_page '{"url": "[user-url]"}'
```

3. **Analyze homepage**:
   - Take screenshot for context
   - Extract navigation structure
   - Identify product categories
   - Detect business type (fashion, electronics, etc.)

```bash
mcp-cli call chrome-devtools/take_screenshot '{}'
```

4. **Explore category pages**:
   - Navigate to main categories
   - Analyze product listings
   - Extract product structure
   - Identify filtering options (these become attributes)

5. **Analyze product pages**:
   - Navigate to sample products
   - Extract product details
   - Identify variant options (size, color, etc.)
   - Note pricing structure
   - Check shipping info

6. **Extract business context**:
   - Brand identity
   - Product categories
   - Variant attributes
   - Pricing tiers
   - Shipping requirements

**Interactive Clarification**:

During exploration, ask clarifying questions:

- "I see size options: S, M, L, XL. Should these be variant or product attributes?"
- "Products are grouped by 'Brand'. Should this be a category or collection?"
- "I found color swatches. Should colors use SWATCH or DROPDOWN type?"
- "Some products show 'Out of Stock'. Should I include inventory tracking?"

### Step 2B: Saleor Introspection Workflow

**Prerequisites Check**:

```bash
# Verify credentials
[ -n "$SALEOR_API_URL" ] && [ -n "$SALEOR_TOKEN" ] && echo "READY" || echo "MISSING"
```

If missing, ask user to provide:
- SALEOR_API_URL
- SALEOR_TOKEN

**Introspection Process**:

1. **Run introspect command**:
```bash
npx configurator introspect --url=$SALEOR_API_URL --token=$SALEOR_TOKEN
```

2. **Analyze generated config**:
   - Count entities
   - Identify patterns
   - Note complexity

3. **Ask user about filtering**:
   - Include all products or sample?
   - Include inactive entities?
   - Simplify or preserve full details?

4. **Generate refined config**:
   - Clean up autogenerated content
   - Apply best practices
   - Remove test/demo data
   - Organize structure

### Step 2C: Manual Input Workflow

If chrome-devtools not available or user prefers manual:

**Guided Questions** (progressive disclosure):

1. **Business Type**:
   - What do you sell?
   - Physical or digital products?
   - Variants needed?

2. **Product Structure**:
   - Main product categories?
   - How do products vary? (size, color, model, etc.)
   - Example products?

3. **Attributes**:
   - What options do customers choose?
   - Which options change price/SKU?
   - Attribute types (dropdown, swatch, text)?

4. **Organization**:
   - Category hierarchy?
   - Collections needed?
   - Multiple channels/regions?

### Step 3: Configuration Generation

Based on discovered information, generate config.yml:

**Entity Mapping**:

From website/Saleor to config:
```
Website Categories → Saleor Categories
Product Options → Variant Attributes
Product Specs → Product Attributes
Collections/Tags → Collections
Shipping Info → Shipping Zones
```

**Generate Structure**:

```yaml
# Saleor Store Configuration
# Generated via discovery from [source]
# Date: [current date]

channels:
  - name: "[Detected or user-specified]"
    slug: "main"
    currencyCode: [Detected from prices]
    defaultCountry: [Detected or user-specified]
    isActive: true

productTypes:
  # Detected from product analysis
  - name: "[Product type]"
    isShippingRequired: [true if physical]
    productAttributes:
      - name: "[Spec attributes]"
        type: [PLAIN_TEXT/DROPDOWN/etc]
    variantAttributes:
      - name: "[Option attributes]"
        type: [DROPDOWN/SWATCH]
        values: [Detected values]

categories:
  # Mapped from website navigation
  - name: "[Category]"
    slug: "[slug]"
    children:
      - name: "[Subcategory]"
        slug: "[slug]"

# Optional: Sample products (if requested)
products: [...]
```

### Step 4: Validation & Refinement

After generation:

1. **Show summary**:
```
✓ Discovered configuration from [source]

Detected:
- Business type: [Fashion/Electronics/etc]
- [N] product categories
- [N] variant attributes
- [N] product types
- Shipping: [Required/Not required]
- Currency: [USD/EUR/etc]

Generated:
- [N] channels
- [N] product types
- [N] categories
- [N] attributes
```

2. **Ask for refinements**:
   - "Does this structure match your business?"
   - "Any categories missing?"
   - "Should I add sample products?"

3. **Apply refinements**

4. **Validate**:
```bash
python3 -c "import yaml; yaml.safe_load(open('config.yml'))"
```

5. **Proactively launch config-review agent**:
   - Check generated config quality
   - Suggest improvements
   - Validate relationships

### Step 5: Next Steps

```
✓ Configuration generated and validated

Next steps:
1. Review: /configurator review
2. Refine: /configurator edit
3. Add products: /configurator-model or manual
4. Deploy: npx configurator deploy --url=... --token=...

Need help with product modeling? Run /configurator-model
```

## Chrome DevTools MCP Integration

### Required Tools

This command uses these chrome-devtools MCP tools:
- `new_page` - Launch browser session
- `navigate_page` - Navigate to URLs
- `take_screenshot` - Capture page state
- `evaluate_script` - Extract page data
- `list_pages` - Manage browser tabs
- `close_page` - Clean up

### Graceful Fallback

If chrome-devtools not available:
1. Inform user
2. Explain benefits of using it
3. Offer installation guide
4. Fall back to manual input or introspection

### Installation Guide

If user wants to use chrome-devtools:

```bash
# Install chrome-devtools MCP server
npm install -g @modelcontextprotocol/server-chrome-devtools

# Verify installation
mcp-cli tools chrome-devtools
```

Show them how to configure in Claude Code settings.

## Discovery Patterns

### Pattern Detection

Automatically detect common patterns:

**Fashion Store**:
- Category names: Men, Women, Kids, Accessories
- Attributes: Size, Color, Material, Style
- Variant structure: Size + Color combinations

**Electronics Store**:
- Category names: Phones, Laptops, Tablets, Accessories
- Attributes: Storage, RAM, Color, Condition
- Specs: Screen Size, Processor, Battery

**Food/Grocery**:
- Category names: Fresh, Packaged, Frozen, Beverages
- Attributes: Weight, Volume, Dietary, Allergens
- Variant structure: Size/Weight variants

**Digital/Subscription**:
- Category names: Plans, Add-ons, Services
- Attributes: Tier, Billing Cycle, Features
- No shipping required

### Smart Attribute Classification

Automatically classify attributes as product vs variant:

**Variant Attributes** (affect SKU):
- Size, Color, Storage, RAM
- Options customers choose before adding to cart
- Create multiple SKUs

**Product Attributes** (descriptive):
- Brand, Material, Features, Specs
- Describe the product
- Don't create SKU variants

## Error Handling

- **chrome-devtools not available**: Fall back to manual input
- **Website not accessible**: Check URL, offer alternatives
- **Saleor credentials invalid**: Verify token, check permissions
- **Introspection fails**: Show error, launch troubleshoot agent
- **Complex structure detected**: Ask user to simplify or confirm

## Task Progress Tracking

Create tasks for transparency:

```
Use TaskCreate at start:
1. "Check prerequisites" - activeForm: "Checking prerequisites"
2. "Explore website" - activeForm: "Exploring website"
3. "Analyze structure" - activeForm: "Analyzing structure"
4. "Generate config" - activeForm: "Generating config"
5. "Validate config" - activeForm: "Validating config"
6. "Review findings" - activeForm: "Reviewing findings"

Update status as you progress - user sees clear status.
```

## Skills Referenced

- `saleor-domain` for entity relationships
- `configurator-schema` for config structure
- `configurator-recipes` for pattern matching
- `configurator-cli` for introspect command

## Related Commands

- `/configurator` - Core operations (init, validate, edit, review)
- `/recipe` - Apply pre-built store templates
- `/configurator-model` - Product modeling wizard

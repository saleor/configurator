{
  "description": "Saleor Configurator plugin hooks for context detection, validation, deployment safety, and task completion",
  "hooks": {
    "Stop": [
      {
        "matcher": "*",
        "hooks": [
          {
            "type": "prompt",
            "prompt": "Before stopping, verify task completeness for Saleor configuration work:\n\n**If user asked to modify config.yml:**\n- Was the file actually edited successfully?\n- Was validation suggested or run?\n- Are there unresolved errors or warnings?\n\n**If user asked to deploy:**\n- Was --dry-run shown first (unless user explicitly skipped)?\n- If deployment failed, was troubleshooting offered?\n- Were any critical errors left unaddressed?\n\n**If user asked to import data:**\n- Was the import completed?\n- Were all required columns mapped?\n- Was config-review suggested for the imported data?\n\n**If user asked to set up configuration:**\n- Was config.yml created?\n- Was config-review run on the generated file?\n\n**Decision:**\n- If task appears incomplete and user didn't explicitly say to stop → {\"decision\": \"block\", \"reason\": \"Task incomplete: [specific item]. Would you like me to continue?\"}\n- If task is complete OR user said to stop/cancel/that's enough → {\"decision\": \"approve\"}\n- If just answering a question (no action task) → {\"decision\": \"approve\"}"
          }
        ]
      }
    ],
    "SessionStart": [
      {
        "matcher": "*",
        "hooks": [
          {
            "type": "command",
            "command": "bash ${CLAUDE_PLUGIN_ROOT}/hooks/scripts/session-context.sh",
            "timeout": 10
          }
        ]
      }
    ],
    "PreToolUse": [
      {
        "matcher": "Write|Edit",
        "hooks": [
          {
            "type": "prompt",
            "prompt": "If the file being written/edited is config.yml or ends with .yml/.yaml in the current working directory:\n\n1. Validate YAML syntax - check for indentation errors, missing colons, invalid characters\n2. If syntax is invalid, respond with: {\"decision\": \"block\", \"reason\": \"YAML syntax error: [specific error description]\"}\n3. If syntax is valid, respond with: {\"decision\": \"allow\"}\n\nFor non-YAML files, respond with: {\"decision\": \"allow\"}"
          }
        ]
      },
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "prompt",
            "prompt": "If the bash command contains 'configurator deploy' or 'pnpm dev deploy':\n\n1. Check if this is a dry-run (--dry-run flag present) - if so, respond {\"decision\": \"allow\"}\n2. Check if the user has been warned about potential deletions in this conversation\n3. If this is a real deployment (not dry-run) and deletions haven't been discussed, respond with:\n   {\"decision\": \"block\", \"reason\": \"Deployment may modify your Saleor store. Please run with --dry-run first to preview changes, or confirm you understand changes will be applied.\"}\n4. Otherwise respond {\"decision\": \"allow\"}\n\nFor non-deploy bash commands, respond {\"decision\": \"allow\"}"
          }
        ]
      }
    ],
    "PostToolUse": [
      {
        "matcher": "Write|Edit",
        "hooks": [
          {
            "type": "prompt",
            "prompt": "If config.yml was just modified:\n\n1. Note that the configuration has changed\n2. Suggest: \"Configuration updated. Would you like me to run a diff to preview what will change on your Saleor instance?\"\n3. This is non-blocking - the user can decline\n\nRespond with a brief, helpful message about next steps."
          }
        ]
      },
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "prompt",
            "prompt": "Analyze the bash command output for Configurator CLI operations:\n\n**If command was 'configurator deploy' or 'pnpm dev deploy':**\n\nOn Success:\n- Summarize changes: count of created, updated, deleted entities by type\n- Suggest verifying changes in Saleor Dashboard\n- Recommend running introspect to update local config if needed\n\nOn Failure:\n- Identify error type (validation, auth, network, GraphQL)\n- Provide specific guidance based on error\n- Offer to run the troubleshoot agent for deeper analysis\n\n**If command was 'configurator introspect' or 'pnpm dev introspect':**\n\nOn Success:\n- Note that config.yml was generated/updated from live Saleor instance\n- Suggest reviewing the generated configuration for accuracy\n- Offer to run config-review agent for quality check\n- Remind about version control: consider committing config.yml\n\nOn Failure:\n- Check for authentication errors (verify SALEOR_TOKEN)\n- Check for network errors (verify SALEOR_API_URL)\n- Offer troubleshoot agent for diagnosis\n\n**If command was 'configurator diff' or 'pnpm dev diff':**\n\nOn Success:\n- Summarize what would change (creates, updates, deletes)\n- If deletions detected, warn explicitly\n- Suggest next steps (deploy if looks good, or edit config first)\n\nProvide a concise, actionable summary."
          }
        ]
      }
    ]
  }
}

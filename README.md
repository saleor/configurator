# Configurator

> [!WARNING]
> This project is in early development. Please use with caution.

Configurator is a "commerce as code" tool that helps you automate the creation and management of data models in Saleor. Instead of manually creating product types, attributes, products, and variants, you can define them in a configuration file and let the tool handle the synchronization with your Saleor instance.

## Quickstart

1. Create an app token with all permissions.
2. Introspect your current configuration from Saleor to `config.yml`:

```bash
pnpm introspect --url="https://your-store.saleor.cloud/graphql/" --token="your-app-token""
```

3. Edit the configuration file to your needs. You can find the schema documentation in [SCHEMA.md](SCHEMA.md).
4. Push the changes to Saleor:

```bash
pnpm push --url="https://your-store.saleor.cloud/graphql/" --token="your-app-token"
```

The above will apply the changes to your Saleor instance.

## Configuration

```yaml
shop:
  defaultMailSenderName: "Saleor Store"
  defaultMailSenderAddress: "store@example.com"
  displayGrossPrices: true
  trackInventoryByDefault: true
channels:
  - name: Poland
    currencyCode: PLN
    defaultCountry: PL
    slug: poland
    isActive: false
productTypes:
  - name: Book
    productAttributes:
      - name: Author
        inputType: PLAIN_TEXT
      - name: Genre
        inputType: DROPDOWN
        values:
          - name: Fiction
          - name: Non-Fiction
    variantAttributes:
      - name: Format
        inputType: DROPDOWN
        values:
          - name: Hardcover
          - name: Paperback
pageTypes:
  - name: Blog Post
    attributes:
      - name: Title
        inputType: PLAIN_TEXT
      - name: Published Date
        inputType: DATE
categories:
  - name: "Fiction"
    subcategories:
      - name: "Fantasy"
products:
  - name: "The Lord of the Rings"
    productType: "Book"
    category: "Fiction/Fantasy"
    attributes:
      Author: "J.R.R. Tolkien"
      Genre: "Fantasy"
      - channel: "poland"
        isPublished: true
    variants:
      - name: "Hardcover"
        sku: "LOTR-HC"
        attributes:
          Format: "Hardcover"
        channelListings:
          - channel: "poland"
            price: 89.99
```

> [!TIP]
> See [example.yml](example.yml) for a complete configuration example, or [SCHEMA.md](SCHEMA.md) for detailed schema documentation with all available properties.

## Development

### Installing dependencies

```bash
pnpm install
```

This will install the dependencies and fetch the Saleor schema needed for [gql.tada](https://gql-tada.0no.co/) to generate the types.

### Schema Documentation

The configuration schema is automatically documented from Zod schemas with GraphQL field mappings. The `SCHEMA.md` file is automatically regenerated by CI when schema files change.

**Manual generation** (if needed):

```bash
pnpm run generate-docs
```

The documentation includes:

- GraphQL field mappings for each configuration option
- Field types and required/optional status
- Enum values and examples
- Proper markdown structure with table of contents

### Versioning

This project uses [Changesets](https://github.com/changesets/changesets) for version management and changelog generation.

Please execute the following command when making changes that should be released:

```bash
# Document your changes
pnpm changeset
```

**Automated workflow:**

1. PRs require changesets (enforced by CI)
2. When PRs with changesets are merged, a Release PR is automatically created
3. Merging the Release PR finalizes the version and creates a GitHub release

**Skip changesets:** Add the `skip-changeset` label to PRs that don't need versioning (docs, tests, internal changes).

## Commands

### `pnpm push`

Reads the configuration file from a given path and creates/updates the data models in Saleor.

#### Options

- `--url` (required): The URL of the Saleor instance
- `--token` (required): App token with necessary permissions
- `--config` (optional): Path to configuration file (defaults to `config.yml`)

#### Usage

```bash
# Basic usage
pnpm push --url="https://your-store.saleor.cloud/graphql/" --token="your-app-token"

# With custom config file
pnpm push --url="https://your-store.saleor.cloud/graphql/" --token="your-app-token" --config="production.yml"
```

Currently, it supports:

- [x] Shop settings configuration
- [x] Channels with settings (payment, stock, order, checkout)
- [x] Attributes and product types
- [x] Page types with attributes
- [x] Categories and subcategories
- [x] Products with variants, SKUs, and attributes
- [x] Product and variant channel listings with pricing
- [ ] Warehouses and shipping zones
- [ ] Collections and discounts

### `pnpm introspect`

Retrieves the configuration from the Saleor instance and saves it to a file under the given path.

#### Options

- `--url` (required): The URL of the Saleor instance
- `--token` (required): App token with necessary permissions
- `--config` (optional): Path to configuration file (defaults to `config.yml`)
- `--force` (optional): Skip confirmation prompts and overwrite files without asking
- `--dry-run` (optional): Preview changes without making any modifications

#### Usage

```bash
# Basic usage (shows diff and asks for confirmation)
pnpm introspect --url="https://your-store.saleor.cloud/graphql/" --token="your-app-token"

```
